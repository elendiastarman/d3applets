<!DOCTYPE html PUBLIC "-//W3C//Dli XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/Dli/xhtml11.dli">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
		<title>QFTASM Interpreter</title>
		
		{% load staticfiles %}
		<style>
			input { margin: 5px; }
            textarea { width: 100%; height: 20em; }
            th { border: 2px solid black; padding: 3px; text-align: center; }
            table { border-collapse: collapse; font-family: monospace; text-align: right; margin: 10px; }
            td.asm { text-align: left; }
            tr.highlight > td { background-color: #FF8; }
            tr.highlight2 > td { background-color: #FFA; }
		</style>
	</head>
	
	<body style="margin-left: 20px">
	
		<h1>QFTASM Interpreter</h1>
		<p id="desc">An interpreter for QFTASM (Quest For Tetris Assembly).</p>
        
        <textarea id="asm-code">0. MLZ -1 3 3;
1. MLZ -1 2 1;
2. MLZ -1 26 0; beginWhile0_infinite_loop
3. MLZ 0 0 0;
4. MLZ -1 3 4;
5. MLZ -1 22 0; beginWhile1_trials
6. SUB A4 A3 2;
7. MLZ -1 A3 5;
8. MLZ -1 12 0; beginWhile2_repeated_subtraction
9. SUB 0 A5 2;
10. SUB A5 A4 5;
11. SUB 0 A5 2;
12. MLZ A2 10 0; endWhile2_repeated_subtraction
13. MLZ 0 0 0;
14. MNZ A5 20 0; beginIf3_divisible
15. MLZ 0 0 0;
16. ADD A3 2 3;
17. MLZ -1 3 4;
18. MLZ -1 21 0; beginElse4_not_divisible
19. MLZ 0 0 0; endIf3_divisible
20. ADD A4 2 4; endElse4_not_divisible
21. SUB A4 A3 2;
22. MLZ A2 7 0; endWhile1_trials
23. MLZ 0 0 0;
24. MLZ -1 A3 1;
25. ADD A3 2 3;
26. MNZ 1 4 0; endWhile0_infinite_loop
27. MLZ 0 0 0;</textarea>
        <p>
            <button id="set-code" onclick="set_code()">Set code</button> | 
            <button id="run-code" onclick="run_code()" disabled>Run</button>
            <!-- <button id="stop-code" onclick="stop_code()" disabled hidden>Stop</button> -->
            <button id="step-code" onclick="step_code()" disabled>Step</button>
            <button id="slow-code" onclick="slow_code()" disabled>Slow</button> &ndash;
            Ticks per sec: <input type="number" id="tps" value="5" min="1" max="100"/>;
            Millisecs per tick: <input type="number" id="mspt" value="200" min="10" max="1000"/>
        </p>
        
        <hr/>
        
        <p id="error" style="color: red;"></p>
        <p style="clear: both">Program counter: <span id="pc">0</span></p>
        
        <table id="machine-code" style="float: left">
            <tr>
                <th colspan=2 rowspan=2>ASM</th>
                <th colspan=2 rowspan=2>Opcode</th>
                <th colspan=2>Address 1</th>
                <th colspan=2>Address 2</th>
                <th colspan=2>Address 3</th>
            </tr>
            <tr>
                <th>Type</th>
                <th>Location</th>
                <th>Type</th>
                <th>Location</th>
                <th>Type</th>
                <th>Location</th>
            </tr>
        </table>
        
        <table id="ram-bank" style="float: left">
            <tr>
                <th>Address (decimal)</th>
                <th>Address (binary)</th>
                <th>Data (decimal)</th>
                <th>Data (binary)</th>
                <th>Reads</th>
                <th>Writes</th>
            </tr>
        </table>
        
        <div style="clear:both;"></div>
        
        <p>
            Addresses to stop on when read from: <input type="text" id="breakpoints-read" onchange="set_breakpoints()"/> <br/>
            Addresses to stop on when written to: <input type="text" id="breakpoints-write" onchange="set_breakpoints()"/>
        </p>
        
        <br/><br/>
		
		<svg id="field">
			<g id="blocks"></g>
		</svg>
		
		
	
		<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		<script src="{% static 'd3applets/qftasm.js' %}"></script>
		
	</body>
</html>